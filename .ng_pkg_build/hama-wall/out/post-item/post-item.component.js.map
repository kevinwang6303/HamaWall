{"version":3,"file":"post-item.component.js","sourceRoot":"","sources":["../../../../src/app/pages/home/post-item/post-item.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Output, EventEmitter, Input } from '@angular/core';\r\nimport { PostItemService, IFilesArray, IPostInfo } from './post-item.service';\r\nimport swal from 'sweetalert2';\r\n\r\nimport { AutoDestroy } from '@hamastar/auto-destroy';\r\nimport { IPost } from '../theme/models/hhd-model';\r\nimport { BlockViewService } from '@hamastar/block-view';\r\n\r\n@Component({\r\n  selector: 'app-post-item',\r\n  template: `<div class=\"post-item\">\r\n  <header class=\"header\" fxLayoutAlign=\"space-around center\">\r\n    <section fxLayout=\"column\" fxLayoutAlign=\"center\">\r\n      <h3>\r\n        分享你的生活吧\r\n      </h3>\r\n      <p>{{ today | date:'yyyy/MM/dd' }}</p>\r\n    </section>\r\n    <img class=\"avatar\" src=\"assets/images/evan.jpg\" alt=\"\">\r\n  </header>\r\n  <section class=\"content\" fxLayoutAlign=\"center\">\r\n    <textarea class=\"reply-input\" placeholder=\"kevinwang6303，你在想些什麼呢!\" [(ngModel)]=\"textContent\"></textarea>\r\n  </section>\r\n  <section class=\"content-img\">\r\n    <img [ngClass]=\"{'active':item.choice}\" (click)=\"choiceItem(item)\" class=\"img\" [src]=\"item.blob | safe:'resourceUrl'\" alt=\"\"\r\n      *ngFor=\"let item of filesArray\">\r\n  </section>\r\n  <footer fxLayoutAlign=\"space-between\">\r\n    <div>\r\n      <button mat-raised-button color=\"accent\" (click)=\"tempFiles.click()\">\r\n        <input #tempFiles type=\"file\" class=\"none\" (ngxf-select)=\"uploadFile($event)\" accept=\"image/*,.svg\" multiple/> 上傳圖片\r\n      </button>\r\n      <button mat-raised-button color=\"warn\" (click)=\"remove()\">刪除選擇</button>\r\n    </div>\r\n    <button mat-raised-button color=\"primary\" (click)=\"shared()\">分享\r\n    </button>\r\n  </footer>\r\n</div>\r\n`,\r\n  styles: [`.post-item {\n  -webkit-box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);\n          box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);\n  background: white;\n  margin-bottom: 2em; }\n  .post-item .avatar {\n    width: 80px;\n    height: 80px;\n    border-radius: 50%; }\n  .post-item .content {\n    border-bottom: 1px solid rgba(0, 0, 0, 0.08);\n    padding-bottom: 0.3em; }\n    .post-item .content .reply-input {\n      width: 90%;\n      border: 1px solid rgba(0, 0, 0, 0.08);\n      outline: none;\n      max-width: 90%;\n      resize: none;\n      height: 4em; }\n  .post-item .content-img {\n    border-bottom: 1px solid rgba(0, 0, 0, 0.08); }\n    .post-item .content-img .img {\n      opacity: .5;\n      margin: .3em;\n      width: 100px;\n      height: 100px;\n      cursor: pointer; }\n      .post-item .content-img .img:hover {\n        opacity: 1; }\n      .post-item .content-img .img.active {\n        border: 2px solid red;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        opacity: 1; }\n\n@media screen and (max-width: 666px) {\n  .post-item .content-img .img {\n    margin: .7em; } }\n`]\r\n})\r\nexport class PostItemComponent extends AutoDestroy implements OnInit {\r\n  // 發文頁面用到的今天日期\r\n  today = new Date();\r\n\r\n  // 欲上傳的array\r\n  filesArray: IFilesArray[] = [];\r\n\r\n  // 要發文的內容\r\n  textContent: string;\r\n\r\n  @Input() postId: string;\r\n\r\n  @Input() userId: string;\r\n\r\n  @Output() addItem = new EventEmitter();\r\n\r\n  constructor(\r\n    private _postItemService: PostItemService,\r\n    private _blockViewService: BlockViewService\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit() {}\r\n\r\n  // 選擇要刪掉的檔案\r\n  choiceItem(item) {\r\n    item.choice = !item.choice;\r\n  }\r\n\r\n  uploadFile(files: File[]) {\r\n    // 限制max 10個檔案上傳\r\n    if (\r\n      this.filesArray.length === 10 ||\r\n      this.filesArray.length + files.length > 10\r\n    ) {\r\n      swal({\r\n        title: '警告!',\r\n        text: '最多只能上傳10個檔案',\r\n        type: 'warning'\r\n      });\r\n      return;\r\n    }\r\n\r\n    // 去service邏輯處理\r\n    this.filesArray = this._postItemService.uploadFunction(\r\n      files,\r\n      this.filesArray\r\n    );\r\n  }\r\n\r\n  remove() {\r\n    // 去service邏輯處理\r\n    this.filesArray = this._postItemService.removeFunction(this.filesArray);\r\n  }\r\n\r\n  shared() {\r\n    // 因為沒有經過base，所以要自己呼叫block起來\r\n    this._blockViewService.block();\r\n    // 塞好要新增的資訊\r\n    const info: IPostInfo = {\r\n      postId: this.postId,\r\n      userId: this.userId,\r\n      content: this.textContent\r\n    };\r\n    this._postItemService\r\n      .uplaodFiles(this.filesArray, info)\r\n      .takeUntil(this._destroy$)\r\n      .subscribe(\r\n        (x: any) => {\r\n          if (x.data) {\r\n            // 讓外面知道發文了\r\n            this.addItem.emit(x.data);\r\n            // 把照片清掉\r\n            this.filesArray = this._postItemService.removeFunction(\r\n              this.filesArray,\r\n              true\r\n            );\r\n            // 嚴謹一點把array變0\r\n            this.filesArray.length = 0;\r\n            this.textContent = '';\r\n            this._blockViewService.unblock();\r\n          }\r\n        },\r\n        error => {\r\n          this._blockViewService.unblock();\r\n          swal({\r\n            title: '錯誤訊息!!!',\r\n            text: '伺服器發生錯誤，請聯絡管理者!',\r\n            type: 'error'\r\n          });\r\n        }\r\n      );\r\n  }\r\n}\r\n"]}